<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- login-modal.xhtml -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <h:form id="loginForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loginModalLabel">Login</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"/>
                    </div>

                    <div class="modal-body">
                        <ul class="nav nav-tabs mb-3" id="loginTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general"
                                        type="button" role="tab" aria-controls="general" aria-selected="true">
                                    General
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="student-tab" data-bs-toggle="tab" data-bs-target="#student"
                                        type="button" role="tab" aria-controls="student" aria-selected="false">
                                    Student
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content" id="loginTabContent">
                            <!-- General Login -->
                            <div class="tab-pane fade show active" id="general" role="tabpanel">
                                <div class="mb-3">
                                    <label class="form-label">Username</label>
                                    <p:inputText value="#{loginBean.user.username}" styleClass="form-control"/>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <p:password value="#{loginBean.user.password}" feedback="false" styleClass="form-control"/>
                                </div>
                            </div>

                            <!-- Student Login -->
                            <div class="tab-pane fade" id="student" role="tabpanel">
                                <div class="mb-3">
                                    <label class="form-label">Student ID No.</label>
                                    <p:inputText value="#{loginBean.username}" styleClass="form-control"/>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password</label>
                                    <p:password value="#{loginBean.password}" feedback="false" styleClass="form-control"/>
                                </div>
                                <h:inputHidden value="#{loginBean.loginType}" />
                                <div class="text-center mt-3">
                                    <h:link outcome="signup-student" value="Don't have an account? Sign up here" styleClass="text-primary"/>
                                </div>
                            </div>
                        </div>

                        <p:messages id="loginMessages" closable="true"/>
                    </div>

                    <div class="modal-footer">
                        <p:commandButton value="Login"
                                         action="#{loginBean.login}"
                                         ajax="true"
                                         process="@form"
                                         update="@form loginMessages"
                                         styleClass="p-button-primary"
                                         onclick="this.disabled = true; PF('loginBlocker').show();"
                                         onerror="this.disabled=false; PF('loginBlocker').hide();"
                                         oncomplete="if (args &amp;&amp; args.loginFailed) {
                                         $('#loginModal').modal('hide');
                                         setTimeout(function() { PF('loginErrorWidget').show(); }, 300);
                                         }"/>
                    </div>

                    <div class="text-start px-3 pb-2">
                        <h:commandLink value="Forgot Password?"
                                       onclick="$('#loginModal').modal('hide'); PF('forgotDialog').show(); return false;"
                                       styleClass="btn btn-link p-0 text-decoration-none"/>
                    </div>

                    <p:dialog widgetVar="loginBlocker" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
                        <p:graphicImage name="loading.gif" library="gifs"/>
                        <h:outputText value="Logging in, please wait..."/>
                    </p:dialog>
                </h:form>
            </div>
        </div>
    </div>

    <!-- Login Error Dialog -->
    <p:dialog id="loginErrorDialog"
              widgetVar="loginErrorWidget"
              header="Login Failed"
              modal="true"
              closable="true"
              draggable="false"
              resizable="false"
              showEffect="fade"
              hideEffect="fade"
              width="350"
              position="top">
        <h:outputText value="Invalid username or password. Please try again."/>
    </p:dialog>

    <!-- Forgot Password Dialog -->
    <p:dialog header="Forgot Password?" widgetVar="forgotDialog" modal="true" closable="true" resizable="false" draggable="false">
        <h:outputText value="Please contact the System Administrator to recover your account."/>
    </p:dialog>

</ui:composition>


