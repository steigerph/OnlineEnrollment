<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <body>

        <ui:composition template="./../template/template.xhtml">

            <ui:define name="sidebar">

            </ui:define>

            <ui:define name="content">
                <h:form id="courseForm">

                    <h2>Course Search and Management</h2>

                    <p:messages id="msgs" closable="true" />

                    <p:panel header="Search Courses by Program and Curriculum Year" style="max-width: 600px">
                        <p:panelGrid columns="2" style="width:100%" columnClasses="ui-grid-col-6,ui-grid-col-6">

                            <!-- Program Dropdown -->
                            <h:outputLabel for="programFilter" value="Program:" />
                            <p:selectOneMenu id="programFilter" value="#{courseBean.selectedProgramId}" style="width:100%">
                                <f:selectItem itemLabel="Select Program" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{courseBean.programList}" var="prog"
                                               itemValue="#{prog.program_id}" itemLabel="#{prog.program_name}" />
                            </p:selectOneMenu>

                            <!-- Curriculum Year Dropdown -->
                            <h:outputLabel for="currYearFilter" value="Curriculum Year:" />
                            <p:selectOneMenu id="currYearFilter" value="#{courseBean.selectedCurrYear}" style="width:100%">
                                <f:selectItem itemLabel="All" itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{courseBean.curriculumYearList}" var="cy"
                                               itemValue="#{cy}" itemLabel="#{cy}" />
                            </p:selectOneMenu>
                        </p:panelGrid>

                        <p:commandButton value="Search" icon="pi pi-search"
                                         action="#{courseBean.searchCoursesByFilters}"
                                         update="courseTable msgs"
                                         styleClass="p-mt-2" />
                    </p:panel>


                    <!-- Table of Courses -->
                    <p:dataTable id="courseTable" value="#{courseBean.filteredCourses}" var="c" 
                                 editable="true" editMode="row" 
                                 rowKey="#{c.courseId}" style="margin-top:20px" paginator="true" rows="10">

                        <p:column headerText="Code">
                            <p:cellEditor>
                                <f:facet name="output">#{c.courseCode}</f:facet>
                                <f:facet name="input"><p:inputText value="#{c.courseCode}" /></f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Title" width="300">
                            <p:cellEditor>
                                <f:facet name="output">#{c.courseTitle}</f:facet>
                                <f:facet name="input"><p:inputText value="#{c.courseTitle}" /></f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Units">
                            <p:cellEditor>
                                <f:facet name="output">#{c.units}</f:facet>
                                <f:facet name="input"><p:spinner value="#{c.units}" min="1" max="10" /></f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Semester">
                            <p:cellEditor>
                                <f:facet name="output">#{c.semester}</f:facet>
                                <f:facet name="input">
                                    <p:selectOneMenu value="#{c.semester}">
                                        <f:selectItem itemLabel="1st" itemValue="1st" />
                                        <f:selectItem itemLabel="2nd" itemValue="2nd" />
                                    </p:selectOneMenu>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Year Level">
                            <p:cellEditor>
                                <f:facet name="output">#{c.yearLevel}</f:facet>
                                <f:facet name="input">
                                    <p:selectOneMenu value="#{c.yearLevel}">
                                        <f:selectItem itemLabel="1st" itemValue="1" />
                                        <f:selectItem itemLabel="2nd" itemValue="2" />
                                        <f:selectItem itemLabel="3rd" itemValue="3" />
                                        <f:selectItem itemLabel="4th" itemValue="4" />
                                    </p:selectOneMenu>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Actions">
                            <p:rowEditor />
                            <p:commandButton icon="pi pi-trash" title="Delete"
                                             action="#{courseBean.deleteCourse(c.courseId)}"
                                             update="courseTable msgs"
                                             styleClass="ui-button-danger p-ml-2" />
                        </p:column>
                    </p:dataTable>

                </h:form>
            </ui:define>

        </ui:composition>

    </body>
</html>
